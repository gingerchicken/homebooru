{% extends "booru/posts/base/with-tags.html" %}
{% load static %}

{% block page_name %}
	{% if post.title %}{{ post.title }}{% else %}{% for tag in post.tags.all %}{{tag.tag}} {% endfor %}{% endif %}
{% endblock %}

{% block main_tags %}
	{% include "booru/posts/components/search.html" %}
	{% with tags as sorted_tags%}{% with request.endpoint|concat:'?' as url %}{% include "booru/posts/components/sorted-tags.html" %}{% endwith %}{% endwith %}
	<div id="searchTags"></div>
	<div id="postStatistics">
		<h3>Statistics</h3>
		<li>Id: {{ post.id }}</li>
		<li>Posted: {{post.timestamp}}<br> by <a href="{% if post.owner %} /accounts/profile/{{ post.owner.id }} {% else %} # {% endif %}">{% if post.owner %}{{post.owner}}{% else %}Anonymous User{% endif %}</a></li>
		<li>Size: {{ post.width }}x{{ post.height }}</li>
		{% if post.source|length > 0 %}<li>Source: <a href="{{post.source}}" rel="nofollow">{{post.source}}</a></li>{% endif %}
		<li>Rating: {{post.rating|title}}</li>
		<li>Score: <span>{{post.score}}</span> 
			(vote <a href="javascript:;" onclick="postVote('up');">Up</a>)
		</li>
		<li style="padding-top: 10px;"></li>
	</div>
	<div id="postOption">
		<h3>Options</h3>
		<li><a href="{{post.id}}?tags={{search_param}}&resize=1" onclick="Homebooru.Posts.setImageUrl('{{post.media_url}}'); $('#resized_notice').hide(); return false;">Resize</a></li>
		<li><a href="/{{post.media_url}}" target="_blank" style="font-weight: bold;">Original</a></li>
		<div id="moderation-options" style="display: none;">
			<li><a href="#" onclick="view.delete();">Delete</a></li>
			<li><div id="pfd"><a href="#" onclick="pflag({{post.id}}); return false;">Flag for deletion</a></div></li>
			<li><a href="#" onclick="postVote('up'); addFav({{post.id}}); return false;">Add to favorites</a></li>
			<li><a href="#" onclick="Homebooru.Pools.addImage({{post.id}}); return false;">Add to Pool</a></li>
			<li><a href="#" onclick="Homebooru.Posts.lockPost(); return false;">Lock</a></li>
		</div>
	</div>
{% endblock %}

{% block main_content %}
	<div style="margin-left: 15px; margin-right: 15px;">
		{% if post.sample and not resize %}
			<div class="alert alert-info" id="resized_notice">
				This image has been resized. Click <a href="?id={{post.id}}&tags={{search_param}}&resize=1" onclick="Homebooru.Posts.setImageUrl('<%= originalUrl %>'); $('#resized_notice').hide(); return false;"><b>here</b></a> to view the original image.
				<a href="#" onclick="Cookie.create('resize-original',1); Cookie.create('resize-notification',1); Homebooru.Posts.setImageUrl('<%= originalUrl %>'); $('#resized_notice').hide(); return false;"><b>Always view original</b></a> | <a href="#" onclick="Cookie.create('resize-notification',1); $('#resized_notice').hide(); return false;"><b>Do not show this message</b></a>.
			</div>
		{% endif %}
		<div class="alert alert-info">
			<a href="{% if next %}/post/{{next.id}}?tags={{search_param}}{% else %}#{% endif %}">Next</a> <a href="{% if previous %}/post/{{previous.id}}?tags={{search_param}}{% else %}#{% endif %}" style="float:right;">Previous</a>
		</div>

		<div id="post-view">
			<div id="right-col">
				<div>
					<div id="note-container"></div>
					<div id="image-container">
						{% if post.is_video == 1 %}
							<video src="{{post.media_url}}" style="width:100%; max-width: 1000px;" controls>
								<source id="image-video-source" type="video/mp4">

								Your browser does not support HTML5 video.
							</video>
						{% else %}
							<img id="image" src="/{% if post.sample and not resize %}{{post.sample_url}}{% else %}{{post.media_url}}{% endif %}" alt="{% for tag in post.tags.all %}{{tag.tag}} {% endfor %}" {% if post.sample %} data-original-width="{{post.width}}" data-original-height="{{post.height}}" {% endif %}>
						{% endif %}
					</div>
					<br>
					<div style="margin-bottom: 1em;">
						<p id="note-count"></p>
					</div>
					<section id="notes" style="display: none;">
					</section>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Since JavaScript must be enabled, display the moderation-options div.
		$('#moderation-options').show();
	</script>
{% endblock %}

{% block head %}
	<!-- Include Post Moderation -->
	<script type="text/javascript" src="{% static 'js/custom/view-post.js' %}"></script>

	<script>
		const view = new ViewPost('{{ csrf_token }}');
	</script>
{% endblock %}